name: Build

on:
    push:
        branches:
            - master
        paths-ignore:
            - ".github/**"
            - "tools/**"
            - ".editorconfig"
            - "gitignore"

jobs:
    bump-version:
        runs-on: ubuntu-latest
        steps:
            - name: Checkout the source code
              uses: actions/checkout@v2

            #TODO
            - name: Bump version
              uses: remorses/bump-version@js
              with:
                  version_file: mission_framework/VERSION.sqf
              env:
                  GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}

    create-artifact:
        runs-on: ubuntu-latest
        needs: bump-version
        steps:
            - name: Checkout the source code
              uses: actions/checkout@master
              with:
                  ref: master

            # TODO
            - name: Get version
              id: get-version
              run: |
                  cd mission_framework
                  echo "::set-output name=version::$(cat VERSION.sqf)"

            - name: Upload artifact
              uses: actions/upload-artifact@v2
              with:
                  name: MalFramework_v${{ steps.get-version.outputs.version }} #TODO
                  path: |
                      mission_framework/
                      cba_settings.sqf
                      description.ext
                      LICENSE
                      README.md

    draft-release:
        runs-on: ubuntu-latest
        steps:
            - name: Checkout the source code
              uses: actions/checkout@v2

            - name: Release Drafter
              uses: release-drafter/release-drafter@v5
              env:
                  GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
